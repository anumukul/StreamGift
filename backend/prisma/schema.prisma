generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id            String    @id @default(cuid())
  privyId       String    @unique
  walletAddress String    @unique
  email         String?
  twitterHandle String?
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt

  sentStreams     Stream[] @relation("StreamSender")
  receivedStreams Stream[] @relation("StreamRecipient")

  @@index([email])
  @@index([twitterHandle])
}

model SocialMapping {
  id              String   @id @default(cuid())
  socialType      String
  socialHandle    String
  socialHash      String   @unique
  walletAddress   String
  claimed         Boolean  @default(false)
  createdAt       DateTime @default(now())

  @@unique([socialType, socialHandle])
  @@index([walletAddress])
}

model Stream {
  id                   String   @id @default(cuid())
  onChainId            Int      @unique
  senderAddress        String
  recipientAddress     String
  recipientSocialType  String?
  recipientSocialHandle String?
  recipientSocialHash  String?
  totalAmount          String
  claimedAmount        String   @default("0")
  ratePerSecond        String
  startTime            DateTime
  endTime              DateTime
  message              String?
  status               String   @default("ACTIVE")
  createdAt            DateTime @default(now())
  updatedAt            DateTime @updatedAt

  sender    User? @relation("StreamSender", fields: [senderAddress], references: [walletAddress])
  recipient User? @relation("StreamRecipient", fields: [recipientAddress], references: [walletAddress])

  @@index([senderAddress])
  @@index([recipientAddress])
  @@index([recipientSocialHash])
  @@index([status])
}

model Notification {
  id        String   @id @default(cuid())
  streamId  String
  type      String
  channel   String
  recipient String
  sent      Boolean  @default(false)
  sentAt    DateTime?
  createdAt DateTime @default(now())

  @@index([streamId])
}